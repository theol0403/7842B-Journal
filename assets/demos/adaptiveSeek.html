<!DOCTYPE html><html lang="en"><head>
<meta charset="UTF-8">
<link rel="apple-touch-icon" type="image/png" href="data:image/png;base64,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">
<meta name="apple-mobile-web-app-title" content="CodePen">
<link rel="shortcut icon" type="image/x-icon" href="data:image/vnd.microsoft.icon;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAAXNSR0IArs4c6QAABZxJREFUaAXdWkdLZFsQNi3E7HIQI4hhlmZGUQyoqPgHZmUOC5duBPe6UESMGBBx5d4s7pyHe0HMirg2IIKh3vkc686599btvt32wOtXcDnlCV99X53uPnW6DQn5NCIKVU+7en6p50E9/zUDJ3ADx1Dm/dGqjm/q2VFPsBi4fgN5ZB1qttVTiY4gsl3FtfrjZaOcmSAirlPtgIBfqqdI7w0i/58wRfb73yA8NzcXkpmZ+fHMz8//jRDA/B4S6Hft1dUV1dbWkgI3PejDWKAtoAKmp6cpNjbWRFwXgjHMCaQFRMDFxQVVVVU5EtdFwK+uriasCYR9ScD7+ztNTExQTEyMa/IsBmuwFhhfMb8FnJ6eUkVFhY14aGgodXZ2Uk5OjjEGH30YYwHcAgNY/prPApCxsbExio6OtpFJS0uj7e3tDy55eXnGOHwYxjCHyXMLLGD6sxs+CTg+PqaysjIbAWS2q6uLHh7+lFCSAIjAHMyVdgPYiOGLuRLw9vZGIyMjFBUVZSOPjO7s2MsoJwFMDmuk3UAMxEJMN+ZVwNHREf348cNGHBns6ekxZV0P6E0A5mI3gCHtBmIitjdzFIAMDA8PU2RkpI18eno67e7uesR2I4ABgAVMfk9wi9jg4Gk3RAEnJydUXFxsA0Sment76fHxkWM7tr4IAAgwgS3tBriAk2SigIKCAhv5jIwM2tvbkzBsfWtra5SQkGBgwEefG0MMxOJd4DY/P19cLgqQsjAwMECvr68iCHfe3d1Ra2urLTiTwBjmeDLEQCxewy04SSYK4EXWtrCwkA4PDyUc2tzcpJSUFFtgKwbmYK5kwEYM6xr+W1rjkwAA4Y01NDRkvLHwSYJTloPobVNTE+HR+9jHGj438CYFpvSBwfPRSib26ouSk5MpIiLCRqKkpISWl5fFz/L4+HhaXFw04sFHn44LH+cAMIBlHUNMxNb7DUDN8SoAmTo4OKDc3FwTmA6s+6j7r6+vtRC/XfRJ9wR9LfuIhZjWnbWBqg5XArDw+fmZ+vv7KTw8XBSCWn9mZkaKYerDHKc7A7ARA7FgbgTgSunKFF7Iy8sLBIvzVSHmcRyLGANzJeNxpxjSGlc7sL+/T1lZWWLmwUt/Kisr6fz8XHEwG/owps918hELMd3sgFcBSUlJ4ssGdfzq6iqpi7uNFC4rU1NThgL40qUHa4Eh3SvwckJsXaQBqDleBegA8FEt6rX709MT9fX1iSVATU0N4bFi4FDCGqyF8R1Dqnb1tRpvw/VJACpEp3rdqQTQCcD3VJIAW6p8GcNgrTmigLCwMFvWBgcHjcNLW29yUZB1d3eLu4GsY8xbIYhDDbGYNLfgJJkooKioyAaQmppKW1tbEoatD1fHxMREAwM+XzVtky0diIFYTJxbHHaSiQLwiVFaWmoDAVhHRwfd399LWKY+X8tpYAKbCetteXk5XV5emvD5D1EABrGVo6Oj4jXSU0HGwL4IcCoE8ck1Pj7u8bLvKICJ4CKBDOgZYb+9vd2xPHYjAKU1MBhPb53OE+bFrVcBmIiPOWRC+ioFBdfGxgbjGa03AVhjLdYgAGUGzg3EdGOuBDDQ2dmZ42na1tZm2g0nAcg65urZZh9nhtNrnTlYW58EYDEyMzk5KRZkyOj6+vpHDEkAxqSsx8XF0ezsrJWbq799FsCo+HJWOmWRzZaWFsrOzjayDB99nGm9ra+vF8tvjuOt9VsAAyNzyKBOyo2Pi/7CwgLD+N1+WQAi47JSV1fnWkRjYyPd3Nz4TVpfGBABDKh+SjJ9nWLdCZzIS0tLPD0gbUAFgBEy29DQYNuN5uZmur29DQhpHQQC/nylrI980UemcTHBbwMrKytfRHNc/vC/+Jl1Tr1Wg9XmsANB/a8GYZ/fg/5UW4D/PQgWA9efn9x/c8ZOqCfo/t3mX62qwqR92xWgAAAAAElFTkSuQmCC">
<link rel="mask-icon" type="" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNC4zIDI0LjI5Ij48dGl0bGU+cGluLXRhYjwvdGl0bGU+PHBhdGggZD0iTTEyLjE1LDI0LjI5YTEuMTQsMS4xNCwwLDAsMS0uNjUtLjJsLTExLTcuMjhhLjkxLjkxLDAsMCwxLS4zMi0uM2gwbDAtLjA1QTEuMjQsMS4yNCwwLDAsMSwwLDE1LjgyVjguNDVhMS4yMywxLjIzLDAsMCwxLC4xOC0uNjNsMC0uMDZhMSwxLDAsMCwxLC4zMi0uMjlMMTEuNS4xOWExLjIyLDEuMjIsMCwwLDEsMS4zLDBsMTEsNy4yOGExLDEsMCwwLDEsLjMyLjI5aDBhLjEuMSwwLDAsMSwwLC4wNSwxLjIzLDEuMjMsMCwwLDEsLjE4LjYzdjcuMzdhMS4yNCwxLjI0LDAsMCwxLS4xOC42NGwwLC4wNWExLDEsMCwwLDEtLjMyLjNsLTExLDcuMjhBMS4xNCwxLjE0LDAsMCwxLDEyLjE1LDI0LjI5Wm0xLjE1LTcuODRWMjFsNy43OC01LjE3LTMuNDMtMi4zMVpNMy4yMiwxNS44MywxMSwyMVYxNi40NUw2LjY1LDEzLjUyWm01LjQ5LTMuNjksMy40NCwyLjMxLDMuNDQtMi4zMUwxMi4xNSw5LjgyWm0xMSwwTDIyLDEzLjY4VjEwLjZaTTIuMywxMC42djMuMDhsMi4yOS0xLjU0Wm0xMS0yLjc3LDQuMzUsMi45MiwzLjQzLTIuM0wxMy4zLDMuMjhaTTMuMjIsOC40NWwzLjQzLDIuM0wxMSw3LjgzVjMuMjhaIi8+PC9zdmc+" color="#111">
<title>CodePen - Drive Seek</title>
<style>
* {
  margin: 0;
  padding: 0;
  border: none;
  box-sizing: border-box;
  overflow: hidden;
}

body {
  overflow: hidden;
}
</style>
</head>
<body translate="no">
<canvas id="c"></canvas>
<script id="rendered-js">
const PI = Math.PI;
const TAU = Math.PI * 2;

const sgn = v => v > 0 ? 1 : v < 0 ? -1 : 0;

const add = (a, b) => ({ x: a.x + b.x, y: a.y + b.y });
const sub = (a, b) => ({ x: a.x - b.x, y: a.y - b.y });
const mult = (a, b) => ({ x: a.x * b.x, y: a.y * b.y });
const div = (a, b) => ({ x: a.x / b.x, y: a.y / b.y });
const mag = a => Math.sqrt(a.x * a.x + a.y * a.y);
const normalize = a => ({ x: a.x / mag(a), y: a.y / mag(a) });
const multScalar = (a, b) => ({ x: a.x * b, y: a.y * b });
const dot = (a, b) => a.x * b.x + a.y * b.y;
const dist = (a, b) =>
Math.sqrt((a.x - b.x) * (a.x - b.x) + (a.y - b.y) * (a.y - b.y));

const closest = (current, head, target) => {
  const n = normalize(head);
  const v = sub(target, current);
  const d = dot(v, n);
  return add(current, multScalar(n, d));
};

const rollAngle360 = angle => angle - TAU * Math.floor(angle / TAU);
const rollAngle180 = angle => angle - TAU * Math.floor((angle + PI) / TAU);

function angleDiff(angle1, angle2) {
  return rollAngle180(angle2 - angle1);
}

const angleBetweenPoints = (target, current) =>
rollAngle180(Math.atan2(target.y - current.y, target.x - current.x));

const angleToPoint = (target, current) =>
rollAngle180(angleBetweenPoints(target, current) - current.a);

const SPEED_LIM = 0.3;
const TURN_MAG = 3;
const SETTLE_RADIUS = 15; //radius from target where it gives up on turning and just goes forward

// begin program
const canvas = document.getElementById("c");
const c = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let pos = { x: 0, y: 0 };
document.addEventListener("mousemove", e => {
  pos = { x: e.clientX, y: e.clientY };
});

class Bot {
  constructor(x, y, a) {
    this.pos = {
      x: x || canvas.width / 2,
      y: y || canvas.height / 2,
      a: a || PI * Math.random() * 2 - PI };

    this.vel = {
      x: 0,
      y: 0 };

    this.acc = {
      x: 0,
      y: 0 };

    this.spd = {
      l: 0,
      r: 0 };

  }

  seek(target) {
    const close = closest(
    this.pos,
    { x: Math.cos(this.pos.a), y: Math.sin(this.pos.a) },
    pos);


    let V = dist(close, this.pos) / 5; //slow it down so we can see decel
    V = Math.abs(V) > 1 ? sgn(V) : V; //limit to full power

    let tA = angleBetweenPoints(target, this.pos);

    let aP = angleToPoint(close, this.pos);
    if (Math.abs(aP) > PI / 2) {
      V = V * -1;
      tA -= PI * sgn(aP);
    }

    let W = angleDiff(tA, this.pos.a);
    W = dist(this.pos, target) < SETTLE_RADIUS ? 0 : W;
    let Vr = V + W * TURN_MAG;
    let Vl = V - W * TURN_MAG;

    const maxMag = Math.max(Math.abs(Vr), Math.abs(Vl));

    if (maxMag > 1) {
      Vl /= maxMag;
      Vr /= maxMag;
    }

    this.spd = {
      l: Vl,
      r: Vr };


    c.strokeStyle = "#00f";
    c.beginPath();
    c.moveTo(this.pos.x, this.pos.y);
    c.lineTo(close.x, close.y);
    c.closePath();
    c.stroke();

    c.fillStyle = "#00f";
    c.beginPath();
    c.arc(close.x, close.y, 3, 0, Math.PI * 2);
    c.closePath();
    c.fill();

    c.strokeStyle = "g00";
    c.beginPath();
    c.moveTo(close.x, close.y);
    c.lineTo(target.x, target.y);
    c.closePath();
    c.stroke();
  }

  update() {
    c.strokeStyle = "#f00";
    c.beginPath();
    c.moveTo(pos.x, pos.y);
    c.lineTo(this.pos.x, this.pos.y);
    c.closePath();
    c.stroke();

    this.seek(pos);

    let dA = (this.spd.r - this.spd.l) * SPEED_LIM / 4 / PI;
    this.pos.a -= dA;
    this.pos.a = rollAngle180(this.pos.a);

    this.vel.x = Math.cos(this.pos.a) * (this.spd.r + this.spd.l) * SPEED_LIM;
    this.vel.y = Math.sin(this.pos.a) * (this.spd.r + this.spd.l) * SPEED_LIM;

    this.pos.x += this.vel.x;
    this.pos.y += this.vel.y;
  }

  draw() {
    c.fillStyle = "#000";
    c.beginPath();
    c.arc(this.pos.x, this.pos.y, 4, 0, Math.PI * 2);
    c.closePath();
    c.fill();

    c.strokeStyle = "#000";
    c.beginPath();
    c.moveTo(this.pos.x, this.pos.y);
    c.lineTo(
    this.pos.x + Math.cos(this.pos.a) * 10,
    this.pos.y + Math.sin(this.pos.a) * 10);

    c.closePath();
    c.stroke();

    c.strokeStyle = "#0F0";
    c.beginPath();
    c.moveTo(
    this.pos.x + Math.cos(this.pos.a + Math.PI / 2) * 10,
    this.pos.y + Math.sin(this.pos.a + Math.PI / 2) * 10);

    c.lineTo(
    this.pos.x +
    Math.cos(this.pos.a + Math.PI / 2) * 10 +
    this.spd.r * 20 * Math.cos(this.pos.a),
    this.pos.y +
    Math.sin(this.pos.a + Math.PI / 2) * 10 +
    this.spd.r * 20 * Math.sin(this.pos.a));

    c.closePath();
    c.stroke();

    c.strokeStyle = "#0F0";
    c.beginPath();
    c.moveTo(
    this.pos.x + Math.cos(this.pos.a - Math.PI / 2) * 10,
    this.pos.y + Math.sin(this.pos.a - Math.PI / 2) * 10);

    c.lineTo(
    this.pos.x +
    Math.cos(this.pos.a - Math.PI / 2) * 10 +
    this.spd.l * 20 * Math.cos(this.pos.a),
    this.pos.y +
    Math.sin(this.pos.a - Math.PI / 2) * 10 +
    this.spd.l * 20 * Math.sin(this.pos.a));

    c.closePath();
    c.stroke();
  }}


const bots = [new Bot()];

document.addEventListener("click", e => {
  bots.push(new Bot(e.clientX + 100, e.clientY + 100, PI));
});

function animate() {
  requestAnimationFrame(animate);

  c.clearRect(0, 0, canvas.width, canvas.height);

  c.fillStyle = "#000";
  c.beginPath();
  c.arc(pos.x, pos.y, 4, 0, Math.PI * 2);
  c.closePath();
  c.fill();

  bots.forEach(bot => {
    bot.draw();
    bot.update();
  });
}

animate();
    </script>


</body></html>
