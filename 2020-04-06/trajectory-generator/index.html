<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8" /> <meta http-equiv="X-UA-Compatible" content="IE=Edge" /> <meta name="theme-color" content="#94ddff" /> <meta http-equiv="cache-control" content="no-cache" /> <meta http-equiv="expires" content="0" /> <meta http-equiv="pragma" content="no-cache" /> <title>Trajectory Generator - 7842B Journal</title> <link rel="shortcut icon" href="https://theol0403.github.io/7842B-Journal/assets/images/favicon.ico" type="image/x-icon" /> <link rel="stylesheet" href="https://theol0403.github.io/7842B-Journal/assets/css/just-the-docs.css" /> <script type="text/javascript" src="https://theol0403.github.io/7842B-Journal/assets/js/vendor/lunr.min.js" ></script> <script type="text/javascript" src="https://theol0403.github.io/7842B-Journal/assets/js/just-the-docs.js" ></script> <meta name="viewport" content="width=device-width, initial-scale=1" /> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Trajectory Generator | 7842B Journal</title> <meta name="generator" content="Jekyll v4.2.0" /> <meta property="og:title" content="Trajectory Generator" /> <meta name="author" content="Theo Lemay" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Table of contents" /> <meta property="og:description" content="Table of contents" /> <link rel="canonical" href="https://theol0403.github.io/7842B-Journal/2020-04-06/trajectory-generator/" /> <meta property="og:url" content="https://theol0403.github.io/7842B-Journal/2020-04-06/trajectory-generator/" /> <meta property="og:site_name" content="7842B Journal" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2020-04-06T00:00:00+00:00" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Trajectory Generator" /> <script type="application/ld+json"> {"@type":"BlogPosting","description":"Table of contents","mainEntityOfPage":{"@type":"WebPage","@id":"https://theol0403.github.io/7842B-Journal/2020-04-06/trajectory-generator/"},"author":{"@type":"Person","name":"Theo Lemay"},"url":"https://theol0403.github.io/7842B-Journal/2020-04-06/trajectory-generator/","headline":"Trajectory Generator","dateModified":"2020-04-06T00:00:00+00:00","datePublished":"2020-04-06T00:00:00+00:00","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="link" viewBox="0 0 16 16"> <title>Link</title> <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path> </symbol> </svg> <div class="page-wrap"> <div class="side-bar"> <div class="site-header"> <a href="https://theol0403.github.io/7842B-Journal" class="site-title lh-tight"><span class="bteam">7842B</span>&nbsp;Journal </a> <button class="menu-button fs-3 js-main-nav-trigger" data-text-toggle="Hide" type="button">Menu</button> </div> <div class="navigation main-nav js-main-nav"> <nav role="navigation" aria-label="Main navigation"> <ul class="navigation-list"><li class="navigation-list-item"><a href="https://theol0403.github.io/7842B-Journal/404.html" class="navigation-list-link"></a></li><li class="navigation-list-item"><a href="https://theol0403.github.io/7842B-Journal/" class="navigation-list-link">Home</a><ul class="navigation-list-child-list "></ul></li><li class="navigation-list-item active"><a href="https://theol0403.github.io/7842B-Journal/programming" class="navigation-list-link">Programming</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="https://theol0403.github.io/7842B-Journal/programming/skills" class="navigation-list-link">Skills</a><ul class="navigation-list-child-list"><li class="navigation-list-item "> <a href="https://theol0403.github.io/7842B-Journal/2021-02-04/v1-skills/" class="navigation-list-link">V1 Skills</a> </li><li class="navigation-list-item "> <a href="https://theol0403.github.io/7842B-Journal/2021-03-01/v2-skills/" class="navigation-list-link">V2 Skills</a> </li><li class="navigation-list-item "> <a href="https://theol0403.github.io/7842B-Journal/2021-04-03/v3-skills/" class="navigation-list-link">V3 Skills</a> </li></ul></li><li class="navigation-list-item "><a href="https://theol0403.github.io/7842B-Journal/programming/intake" class="navigation-list-link">Intake Automation</a><ul class="navigation-list-child-list"><li class="navigation-list-item "> <a href="https://theol0403.github.io/7842B-Journal/2021-03-24/intake-log-2/" class="navigation-list-link">Intake Log 2</a> </li><li class="navigation-list-item "> <a href="https://theol0403.github.io/7842B-Journal/2021-02-20/intake-log-1/" class="navigation-list-link">Intake Log 1</a> </li></ul></li><li class="navigation-list-item active"><a href="https://theol0403.github.io/7842B-Journal/programming/motion" class="navigation-list-link">Motion Control</a><ul class="navigation-list-child-list"><li class="navigation-list-item "> <a href="https://theol0403.github.io/7842B-Journal/2020-06-01/introduction/" class="navigation-list-link">Introduction</a> </li><li class="navigation-list-item active"> <a href="https://theol0403.github.io/7842B-Journal/2020-04-06/trajectory-generator/" class="navigation-list-link active">Trajectory Generator</a> </li></ul></li></ul></li><li class="navigation-list-item"><a href="https://theol0403.github.io/7842B-Journal/build" class="navigation-list-link">Build</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="https://theol0403.github.io/7842B-Journal/build/v1/" class="navigation-list-link">Robot V1</a><ul class="navigation-list-child-list"><li class="navigation-list-item "> <a href="https://theol0403.github.io/7842B-Journal/2021-01-20/intakes/" class="navigation-list-link">Intake Design</a> </li><li class="navigation-list-item "> <a href="https://theol0403.github.io/7842B-Journal/2021-01-15/chassis/" class="navigation-list-link">Robot Chassis</a> </li></ul></li><li class="navigation-list-item "><a href="https://theol0403.github.io/7842B-Journal/build/v2/" class="navigation-list-link">Robot V2</a><ul class="navigation-list-child-list"><li class="navigation-list-item "> <a href="https://theol0403.github.io/7842B-Journal/2021-02-28/upgrades/" class="navigation-list-link">Upgrades</a> </li><li class="navigation-list-item "> <a href="https://theol0403.github.io/7842B-Journal/2021-02-26/hood-changes/" class="navigation-list-link">Hood Challenges</a> </li><li class="navigation-list-item "> <a href="https://theol0403.github.io/7842B-Journal/2021-02-23/deflector/" class="navigation-list-link">Deflector</a> </li></ul></li><li class="navigation-list-item "><a href="https://theol0403.github.io/7842B-Journal/build/v3/" class="navigation-list-link">Robot V3</a><ul class="navigation-list-child-list"><li class="navigation-list-item "> <a href="https://theol0403.github.io/7842B-Journal/2021-04-02/hood-catapult/" class="navigation-list-link">Hood Catapult</a> </li><li class="navigation-list-item "> <a href="https://theol0403.github.io/7842B-Journal/2021-03-29/intake-changes/" class="navigation-list-link">Intake changes</a> </li><li class="navigation-list-item "> <a href="https://theol0403.github.io/7842B-Journal/2021-03-26/roller-changes/" class="navigation-list-link">Roller changes</a> </li></ul></li></ul></li><li class="navigation-list-item"><a href="https://theol0403.github.io/7842B-Journal/archive" class="navigation-list-link">Archive</a><ul class="navigation-list-child-list "><li class="navigation-list-item "><a href="https://theol0403.github.io/7842B-Journal/2019-11-28/lib7842/" class="navigation-list-link">lib7842</a></li><li class="navigation-list-item "><a href="https://theol0403.github.io/7842B-Journal/2019-11-25/pure-pursuit/" class="navigation-list-link">Pure Pursuit</a></li><li class="navigation-list-item "><a href="https://theol0403.github.io/7842B-Journal/2019-11-20/odom-x-controller/" class="navigation-list-link">Odom X Controller</a></li><li class="navigation-list-item "><a href="https://theol0403.github.io/7842B-Journal/2019-11-15/odom-controller/" class="navigation-list-link">Odom Controller</a></li><li class="navigation-list-item "><a href="https://theol0403.github.io/7842B-Journal/2019-11-10/tests/" class="navigation-list-link">Unit Tests</a></li><li class="navigation-list-item "><a href="https://theol0403.github.io/7842B-Journal/2019-10-19/gui/" class="navigation-list-link">GUI</a></li><li class="navigation-list-item "><a href="https://theol0403.github.io/7842B-Journal/2019-10-18/task-wrapper/" class="navigation-list-link">Task Wrapper</a></li><li class="navigation-list-item "><a href="https://theol0403.github.io/7842B-Journal/2019-10-16/statemachine/" class="navigation-list-link">State Machine</a></li><li class="navigation-list-item "><a href="https://theol0403.github.io/7842B-Journal/2019-10-15/motion-algorithms/" class="navigation-list-link">Motion Algorithms</a></li><li class="navigation-list-item "><a href="https://theol0403.github.io/7842B-Journal/2019-08-19/robot-showcase/" class="navigation-list-link">2018-19 Showcase</a></li></ul></li></ul> </nav> </div> </div> <div class="main-content-wrap js-main-content" tabindex="0"> <div class="main-content"> <div class="page-header js-page-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" class="js-search-input search-input" tabindex="0" placeholder="Search 7842B Journal" aria-label="Search 7842B Journal" autocomplete="off"> <svg width="14" height="14" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" class="search-icon"><title>Search</title><g fill-rule="nonzero"><path d="M17.332 20.735c-5.537 0-10-4.6-10-10.247 0-5.646 4.463-10.247 10-10.247 5.536 0 10 4.601 10 10.247s-4.464 10.247-10 10.247zm0-4c3.3 0 6-2.783 6-6.247 0-3.463-2.7-6.247-6-6.247s-6 2.784-6 6.247c0 3.464 2.7 6.247 6 6.247z"/><path d="M11.672 13.791L.192 25.271 3.02 28.1 14.5 16.62z"/></g></svg> </div> <div class="js-search-results search-results-wrap"></div> </div> <ul class="list-style-none text-small aux-nav"> <li class="d-inline-block my-0 mr-2"><a href="https://theol0403.github.io/7842B-Journal/build">Build</a></li> <li class="d-inline-block my-0"><a href="https://theol0403.github.io/7842B-Journal/programming">Programming</a></li> </ul> </div> <div class="page"> <nav class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="https://theol0403.github.io/7842B-Journal/programming">Programming</a></li> <li class="breadcrumb-nav-list-item"><a href="https://theol0403.github.io/7842B-Journal/programming/motion">Motion Control</a></li> <li class="breadcrumb-nav-list-item"><span>Trajectory Generator</span></li> </ol> </nav> <div id="main-content" class="page-content" role="main"> <h1> <a href="https://theol0403.github.io/7842B-Journal/2020-04-06/trajectory-generator/"> Trajectory Generator </a> - April 06, 2020 </h1> <span class="author">Theo Lemay</span> <article><!-- prettier-ignore-start --> <h2 class="no_toc text-delta" id="table-of-contents"> <a href="#table-of-contents" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Table of contents </h2> <ol id="markdown-toc"> <li><a href="#objectives" id="markdown-toc-objectives">Objectives</a></li> <li><a href="#existing-work" id="markdown-toc-existing-work">Existing Work</a></li> <li><a href="#basic-explanation" id="markdown-toc-basic-explanation">Basic Explanation</a> <ol> <li><a href="#1d-motion" id="markdown-toc-1d-motion">1D Motion</a></li> <li><a href="#2d-motion" id="markdown-toc-2d-motion">2D Motion</a></li> <li><a href="#major-challenge" id="markdown-toc-major-challenge">Major Challenge</a></li> </ol> </li> </ol> <!-- prettier-ignore-end --> <h2 id="objectives"> <a href="#objectives" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Objectives </h2> <p>First, let’s define some objectives for our generator:</p> <ul> <li>We want to develop a trajectory generator that will take a spline as an input and output a list of wheel speeds</li> <li>We want to respect the robot’s kinematics (top motor speed and acceleration)</li> <li>We want the output to be as smooth and accurate as possible</li> <li>We want the generator to be fast enough that we can regenerate <em>while following</em></li> </ul> <p><img src="images/startend.jpg" alt="" /></p> <h2 id="existing-work"> <a href="#existing-work" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Existing Work </h2> <p>Similar projects have been created:</p> <ul> <li><a href="https://docs.wpilib.org/en/stable/docs/software/advanced-controls/trajectories/trajectory-generation.html">WPILib</a></li> <li>Pathfinder <ul> <li><a href="https://github.com/JaciBrunning/Pathfinder">Pathfinder 1</a></li> <li><a href="https://github.com/GrappleRobotics/Pathfinder">Pathfinder 2</a></li> </ul> </li> <li><a href="https://github.com/baylessj/robotsquiggles">Sqiggles</a></li> </ul> <p>However, this project attempts to beat them all, both in theoretical accuracy and generation speed.</p> <h2 id="basic-explanation"> <a href="#basic-explanation" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Basic Explanation </h2> <p>A trajectory generator is made by combining many steps together to form a final product.</p> <h3 id="1d-motion"> <a href="#1d-motion" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> 1D Motion </h3> <p>Let’s say we want the robot to drive a specific <strong>distance</strong> in a <strong>straight line</strong>. How can we do this <strong>without sensors</strong>? How can we make the motion smooth and accurate?</p> <p><img src="images/linear.svg" alt="" class="noshadow" /></p> <p>The solution is called a <strong>motion profile</strong>. A motion profile plans the <strong>velocity</strong> of the robot over <strong>time</strong> while respecting <strong>kinematics</strong> (top motor speed and acceleration).</p> <p>Specifically, whe want to use a <strong>trapezoidal</strong> motion profile. In such a profile, the robot <strong>accelerates</strong>, <strong>cruises</strong> at full speed, then <strong>decelerates</strong>. We can solve this profile in such a way that the robot travels a specific distance (area under the graph).</p> <p><img src="images/simpletrap.png" alt="" class="noshadow" /></p> <h3 id="2d-motion"> <a href="#2d-motion" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> 2D Motion </h3> <p>How can we apply a motion profile to a spline? If we analyze how we want the robot to drive:</p> <ul> <li>Start: we want to start at 0 velocity and accelerate</li> <li>Middle: we want to be moving at the maximum speed possible</li> <li>End: we want to decelerate to 0 velocity</li> </ul> <p>What if we map the distance along the spline to the distance of the motion profile?</p> <p>First we need the motion profile to be a function of distance, not time. That way, we can look at our progress along the spline, and we can find out what velocity we should be travelling at!</p> <p><img src="images/nicetrap.png" alt="" /></p> <p>Finally, we have all the tools we need to start the main algorithm:</p> <ul> <li>Measure the length of the spline, and solve a motion profile for that distance</li> <li>Start at the beginning of the spline</li> <li>What velocity should I be moving given the distance travelled?</li> <li>What is the curvature of the spline?</li> <li>Given the formula \(angular\_velocity = linear\_velocity \cdot curvature\) , what is my angular velocity?</li> <li>Record the linear and angular velocity at \(time=0\)</li> <li>Wait \(0.01s\), then \(delta\_distance = linear\_velocity * 0.01\)</li> <li>Move \(delta\_distance\) along the spline</li> <li>Repeat at new distance</li> </ul> <p>If we can implement all these steps, we can achieve the fundamental structure of the trajectory generator!</p> <h3 id="major-challenge"> <a href="#major-challenge" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Major Challenge </h3> <p>The hardest part about this project is the following:</p> <ul> <li>Given a spline, what is its arc length?</li> <li>Given a spline, what new value of \(t\) do I use after I’ve traveled a certain distance?</li> </ul> <p>Recall that a spline is \((x, y)\) as a function of \(t\), in the range \([0, 1]\).</p> <p>The only way to find arc length of any subset of a spline is extremely inefficient. It involves moving \(t\) in very small increments, and measuring the distances between each point along the spline. After summing the distances, we have the arc length. This takes <strong>seconds</strong> of time.</p> </article> <hr> <footer role="contentinfo"> <p class="text-small text-grey-dk-000 mb-0">Copyright &copy; 2020-2021</p> </footer> </div> </div> </div> </div> </body> </html> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
